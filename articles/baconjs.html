<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="content-type" content="text/html; charset=utf-8"><title>Bacon.js | Abstract Nonsense</title><meta name="generator" content="DocPad v6.54.5" /><link  rel="stylesheet" href="/styles/style.css" /></head><body><div class="stoptape"><div><span data-updated='"2013-04-13T19:55:41.000Z"' data-status="draft" class="updated">This is a draft! It was updated on 14th April 2013.</span></div></div><div id="main"><h1>Bacon.js</h1><article><p>I want to make a demo of Bacon.js which is by the way awesome. Why is it awesome? It makes some tasks solvable without too much thinking.</p>

<pre class="highlighted"><code class="javascript"><span class="keyword">var</span> clicks = $(<span class="string">".submit"</span>).asEventSource(<span class="string">"click"</span>)
</code></pre>

<p>Let&#39;s say you have a REST API to create playlists (in json) and fill them with real audio tracks (in all kinds of audio formats).</p>

<p>The UI is a form with playlist&#39;s title and a list of audio files. When the user clicks send button your program have to POST a document and if the request was successful then PUT each file. </p>

<p>Ok. That&#39;s trivial.<br/>
But the files are large and there are many of them. The user needs to see the status of uploads and also wants an ability to cancel the upload of a file added by mistake.</p>

<p>How do you approach this problem? A typical OOP way is to build some objects which represent action statuses and abstract out raw REST requests. You&#39;ll end up with MVSomething pattern (could be MVC, MVP or MVVM). I won&#39;t tell you why OOP is bad <a href="actually%20only%20class%20based%20OOP%20is%20bad%20%5Banother%20link%5D">link</a>. I&#39;ll just show you another way of solving this task.</p>

<p>The other way is to use Bacon.js. This library lets you represent an eventful system as signal processing network. Anything which can fire an event turns into event stream which you can plug into a box which will do something useful. [snoska Actually there are two kinds of streams: event stream for something discrete and property for something continuos]. There are a lot of boxes for all kind of useful actions like merging or combining streams or mapping them to some data.</p>

<p>You create event streams to POST playlist and then PUT audio tracks. Then you combine the streams of requests results into one stream which you map to a data structure appropriate for uploads visualisation. The structure will look like this: {&ldquo;request1id&rdquo;:&ldquo;done&rdquo;, &ldquo;request2id&rdquo;:&ldquo;uploading&rdquo;,&ldquo;request3id&rdquo;:&ldquo;error&rdquo;}<br/>
Whenever new structure comes in your code will update the UI creating everything missing and updating everything present.</p>

<p>To make cancel buttons work you create another stream of events with ids and cancel request functions and in the end map it to another data structure:<br/>
{&ldquo;request1id&rdquo;:<function>, &ldquo;request2id&rdquo;:<function>,&ldquo;request3id&rdquo;:<function>} <br/>
When the click event kicks in your code takes id of the click button and calls the cancel function which is already there.</p>

<p>The awesomeness of this approach is that you can start to build your solution from any part you comprehend and grow it organically and believe me it won&#39;t grow into a plate of spaghetti. The parts of the processing network you have built are easy to extract into separate modules and reuse for something else. I&#39;m also sure describing application logic from the processes point of view is much more useful from the business perspective. But that&#39;s another story.</p>
</article></div><script >var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-33499743-2']);
_gaq.push(['_trackPageview']);
(function(){
	var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
	ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
	var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();</script><script defer="defer"  src="/scripts/moment.js"></script><script defer="defer"  src="/scripts/article.js"></script></body></html>